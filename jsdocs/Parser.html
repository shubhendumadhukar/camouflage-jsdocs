<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: Parser</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: Parser</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>Parser<span class="signature">(req, res, mockDir)</span><span class="type-signature"></span></h2>
        
            <div class="class-description"><p>Create a parser class which defines methods to parse</p>
<ol>
<li>Request URL to get a matching directory</li>
<li>From matched directory get .mock file content and generate a response</li>
</ol></div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="Parser"><span class="type-signature"></span>new Parser<span class="signature">(req, res, mockDir)</span><span class="type-signature"></span></h4>
    

    











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">express.Request</span>


            
            </td>

            

            

            <td class="description last"><p>Express Request object for current instance of incoming request</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>res</code></td>
            

            <td class="type">
            
                
<span class="param-type">express.Response</span>


            
            </td>

            

            

            <td class="description last"><p>Express response to be sent to client</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>mockDir</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>location of http mocks</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="parser_HttpParser.js.html">parser/HttpParser.js</a>, <a href="parser_HttpParser.js.html#line18">line 18</a>
    </li></ul></dd>
    

    

    

    
</dl>




















    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="getMatchedDir"><span class="type-signature"></span>getMatchedDir<span class="signature">()</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Finds a closest match dir for an incoming request</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="parser_HttpParser.js.html">parser/HttpParser.js</a>, <a href="parser_HttpParser.js.html#line30">line 30</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>matchedDir for a given incoming request</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="getResponse"><span class="type-signature"></span>getResponse<span class="signature">(mockFile)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Defines a default response, if the closest matchedDir is present, parses and sends the response from mockfile,
Looks for API Level, and Global level default response overrides if mockfile is not found.
If no default response overrides are found, send the defined default response</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>mockFile</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>location of of the closest mached mockfile for incoming request</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="parser_HttpParser.js.html">parser/HttpParser.js</a>, <a href="parser_HttpParser.js.html#line50">line 50</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>matchedDir for a given incoming request</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="prepareResponse"><span class="type-signature"></span>prepareResponse<span class="signature">(mockFile)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <ul>
<li>Since response file contains headers and body both, a PARSE_BODY flag is required to tell the logic if it's currently parsing headers or body</li>
<li>Set responseBody to an empty string and set a default response object</li>
<li>Set default response</li>
<li>Compile the handlebars used in the contents of mockFile</li>
<li>Generate actual response i.e. replace handlebars with their actual values and split the content into lines</li>
<li>Split file contents by os.EOL and read file line by line</li>
<li>Set PARSE_BODY flag to try when reader finds a blank line, since according to standard format of a raw HTTP Response, headers and body are separated by a blank line.</li>
<li>If line includes HTTP/HTTPS i.e. first line. Get the response status code</li>
<li>If following conditions are met:
<ul>
<li>Line is not blank; and</li>
<li>Parser is not currently parsing response body yet i.e. PARSE_BODY === false</li>
</ul>
</li>
<li>Then:
<ul>
<li>Split line by :, of which first part will be header key and 2nd part will be header value</li>
<li>If headerKey is response delay, set variable DELAY to headerValue</li>
</ul>
</li>
<li>If parsing response body, i.e. PARSE_BODY === true. Concatenate every line till last line to a responseBody variable</li>
<li>If on last line of response, do following:
<ul>
<li>Trim and remove whitespaces from the responseBody</li>
<li>Compile the Handlebars to generate a final response</li>
<li>Set PARSE_BODY flag back to false and responseBody to blank</li>
<li>Set express.Response Status code to response.status</li>
<li>Send the generated Response, from a timeout set to send the response after a DELAY value</li>
</ul>
</li>
</ul>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>mockFile</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>location of of the closest mached mockfile for incoming request</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="parser_HttpParser.js.html">parser/HttpParser.js</a>, <a href="parser_HttpParser.js.html#line106">line 106</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BackupScheduler.html">BackupScheduler</a></li><li><a href="GlobalController.html">GlobalController</a></li><li><a href="GrpcParser.html">GrpcParser</a></li><li><a href="HandlerBarHelper.html">HandlerBarHelper</a></li><li><a href="MockController.html">MockController</a></li><li><a href="Parser.html">Parser</a></li><li><a href="Protocols.html">Protocols</a></li></ul><h3>Global</h3><ul><li><a href="global.html#app">app</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#registerCustomHandlebars">registerCustomHandlebars</a></li><li><a href="global.html#registerHandlebars">registerHandlebars</a></li><li><a href="global.html#setLogLevel">setLogLevel</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#ui_root">ui_root</a></li><li><a href="global.html#walk">walk</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat May 15 2021 21:07:03 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>